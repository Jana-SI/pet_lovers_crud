<head>
    <!-- css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_listar_consulta.css')}}">

    <!-- js -->
    <script defer src="{{ url_for('static', filename='js/formataDataListaConsulta.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/mostraImgTipoLista.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/hideShow.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/validadorIdPetListaConsulta.js') }}"></script>
</head>

{% extends "base.html" %}
{% from 'bootstrap5/utils.html' import render_icon %}

{% block content %}
<div class="row">
    <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-12">
        <button class="btn btn-lg" id="btnHome"><a
                href="{{url_for('index')}}">{{render_icon('house-heart-fill')}}Home</a></button>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-6 col-xxl-6">

        <form id="formConsultaPets" action="/listar_consulta" method="post">
            <div class="input-group">
                <span class="input-group-text">
                    {{render_icon('search')}}
                </span>
                <div class="form-floating">
                    <input class="form-control" list="listaPets" id="idPet" name="idPet" placeholder="Digitar o nome do pet" onfocusout="verificaIdPet()" oninput="setCustomValidity('')" required>
                    <datalist id="listaPets">
                        {% if todosPetsOption %}
                            {% for pet in todosPetsOption %}
                        <option value="{{pet.0}}">
                                {{pet.0}} - {{pet.1}}, Donos: 

                                {% if donos %}
                                    {% for dono in donos %}
                                        {% if pet.0 == dono.0 %}
                                            {{dono.1}}, 
                                        {% endif %}
                                    {% endfor %}
                                {% endif%}
                            {% endfor %}
                        {% endif %}
                    </datalist>
                    <label for="idPet" class="form-label">id do Pet</label>
                </div>
                <button class="btn" type="submit" id="btnPesquisar" >Pesquisar</button>
            </div>
        </form>

        <button><a href="{{url_for('listar_consulta')}}">Consultas de Hoje</a></button>
        <button><a href="{{url_for('listar_consulta_futura')}}">Proximas consultas</a></button>
        <button><a href="{{url_for('listar_consulta_passada')}}">Historico de consultas</a></button>

        {% if erro %}
        <p class="alert alert-danger text-center" role="alert">{{render_icon('exclamation-triangle-fill')}}
            {{erro}}</p>
        {% endif %}

        {% if dados %}
        <p class="alert alert-success text-center" role="alert">{{render_icon('check-circle-fill')}} A consulta do pet
            {{dados.1}}, dono {{dados.0}} foi cancelada com sucesso!</p>
        {% endif %}

        {% if dadosAtualiza %}
        <p class="alert alert-success text-center" role="alert">{{render_icon('check-circle-fill')}} A consulta do pet
            {{dadosAtualiza.1}}, dono {{dadosAtualiza.0}} foi atualizada com sucesso!</p>
        {% endif %}
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-10 col-sm-10 col-md-10 col-lg-10 col-xl-10 col-xxl-10">

        {% if consultasHoje %}
        <table id="tabConsultas" class="table align-middle text-center">
            <thead>
                <tr>
                    <td colspan="10">
                        <h1>Consultas de Hoje</h1>
                    </td>
                </tr>
                <tr>
                    <td>Data</td>
                    <td>Hora</td>
                    <td>Dono do pet</td>
                    <td>Contato</td>
                    <td>Nome do Pet</td>
                    <td>Tipo</td>
                    <td>Raça</td>
                    <td>Data de nascimento</td>
                    <td>Idade</td>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                {% for consulta in consultasHoje %}
                <tr>
                    <td><span class="data">{{consulta.2}}</span></td>
                    <td>{{consulta.1.strftime("%H:%M")}}</td>
                    <td>{{consulta.3}}</td>
                    <td>{{consulta.4}}</td>
                    <td>{{consulta.5}}</td>
                    <td><span class="tipo">{{consulta.6}}</span><img class="imgTipo" src=""></td>
                    <td>{{consulta.7}}</td>
                    <td><span class="nascimento">{{consulta.8}}</span></td>
                    <td><span class="idade"></span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if consultasFuturas %}
        <table id="tabConsultas" class="table align-middle text-center">
            <thead>
                <tr>
                    <td colspan="10">
                        <h1>Proximas consultas</h1>
                    </td>
                </tr>
                <tr>
                    <td>Data</td>
                    <td>Hora</td>
                    <td>Dono do pet</td>
                    <td>Contato</td>
                    <td>Nome do Pet</td>
                    <td>Tipo</td>
                    <td>Raça</td>
                    <td>Data de nascimento</td>
                    <td>Idade</td>
                    <td>Açoes</td>
                </tr>
            </thead>
            <tbody>
                {% for consulta in consultasFuturas %}
                <tr>
                    <td><span class="data">{{consulta.2}}</span></td>
                    <td>{{consulta.1.strftime("%H:%M")}}
                        
                    </td>
                    <td>{{consulta.3}}</td>
                    <td>{{consulta.4}}</td>
                    <td>{{consulta.5}}</td>
                    <td><span class="tipo">{{consulta.6}}</span><img class="imgTipo" src=""></td>
                    <td>{{consulta.7}}</td>
                    <td><span class="nascimento">{{consulta.8}}</span></td>
                    <td><span class="idade"></span></td>
                    <td>
                        <div class="row justify-content-center align-items-center">
                            <div class="col-6 col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
                                <button id="btnEditar" class="btn btn-lg" onclick="toggleVisibility('{{consulta.0}}')">
                                    {{render_icon('pencil-square')}}
                                </button>
                            </div>
                            <div class="col-6 col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
                                <form id="formDeletar" action="/listar_consulta_deletar/{{consulta.0}}" method="POST">
                                    <button id="btnDeletar" class="btn btn-lg"
                                        type="submit">{{render_icon('trash3-fill')}}</button>
                                </form>
                            </div>
                            <div class="col-8 col-sm-8 col-md-8 col-lg-8 col-xl-8 col-xxl-8">
                                <div style="display: none;" id="{{consulta.0}}">
                                    <form id="formAtualizar" action="/listar_consulta_atualizar/{{consulta.0}}" method="POST">
                                        <div class="input-group">
                                            <span class="input-group-text">{{render_icon('calendar-check-fill')}}</span>
                                            <div class="form-floating">
                                                <input class="form-control" type="datetime-local" id="dataHora" name="dataHora"
                                                    required>
                                                <label for="dataHora">Data e Hora</label>
                                            </div>
                                        </div>
                                        <button class="btn float-end" type="submit" id="btnAgendar">Agendar</button>
                                        <button class="btn float-start" type="reset" id="btnApagar">Redefinir</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if hitoricoConsultas %}
        <table id="tabConsultas" class="table align-middle text-center">
            <thead>
                <tr>
                    <td colspan="10">
                        <h1>Historico de consultas</h1>
                    </td>
                </tr>
                <tr>
                    <td>Data</td>
                    <td>Hora</td>
                    <td>Dono do pet</td>
                    <td>Contato</td>
                    <td>Nome do Pet</td>
                    <td>Tipo</td>
                    <td>Raça</td>
                    <td>Data de nascimento</td>
                    <td>Idade</td>
                </tr>
            </thead>
            <tbody>
                {% for consulta in hitoricoConsultas %}
                <tr>
                    <td><span class="data">{{consulta.2}}</span></td>
                    <td>{{consulta.1.strftime("%H:%M")}}</td>
                    <td>{{consulta.3}}</td>
                    <td>{{consulta.4}}</td>
                    <td>{{consulta.5}}</td>
                    <td><span class="tipo">{{consulta.6}}</span><img class="imgTipo" src=""></td>
                    <td>{{consulta.7}}</td>
                    <td><span class="nascimento">{{consulta.8}}</span></td>
                    <td><span class="idade"></span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if consultaPetEsp %}
            {% for consulta in consultaPetEsp%}
                {{consulta}}
            {% endfor %}
        {% endif%}
    </div>

</div>
{% endblock %}